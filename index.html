<script>
    let hostedImageUrl = "https://iili.io/2yOuSp4.png"; // Default placeholder
    const imgbbApiKey = "f77ae13d7081299400e095b020a1dcd5"; // ✅ Your actual API key

    document.getElementById("imageUpload").addEventListener("change", async function(event) {
        const file = event.target.files[0];
        if (!file) {
            alert("No file selected.");
            return;
        }

        const reader = new FileReader();
        reader.onload = async function(e) {
            let base64Image = e.target.result.split(",")[1]; // Extract Base64 content

            let formData = new FormData();
            formData.append("key", imgbbApiKey);
            formData.append("image", base64Image);

            try {
                let response = await fetch("https://api.imgbb.com/1/upload", {
                    method: "POST",
                    body: formData
                });

                let result = await response.json();
                console.log("ImgBB Response:", result); // Debugging

                if (result.success) {
                    hostedImageUrl = result.data.url; // Get the uploaded image URL
                    document.getElementById("imagePreview").src = hostedImageUrl;
                    document.getElementById("image").value = hostedImageUrl;
                    updatePreview();
                } else {
                    alert("Image upload failed. Error: " + result.error.message);
                }
            } catch (error) {
                console.error("Image upload error:", error);
                alert("Failed to upload image. Check API key and internet connection.");
            }
        };
        reader.readAsDataURL(file);
    });

    function updatePreview() {
        document.getElementById("previewName").textContent = document.getElementById("name").value;
        document.getElementById("previewTitle").textContent = document.getElementById("title").value;

        let imgElement = document.getElementById("imagePreview");
        imgElement.src = hostedImageUrl;
        imgElement.style.width = document.getElementById("imageSize").value + "px";
        imgElement.style.height = document.getElementById("imageSize").value + "px";
        document.getElementById("imageSizeValue").textContent = document.getElementById("imageSize").value + "px";
    }

    function copySignature() {
        let previewBox = document.getElementById("preview-box").cloneNode(true);
        document.body.appendChild(previewBox);

        let range = document.createRange();
        range.selectNodeContents(previewBox);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand("copy");

        document.body.removeChild(previewBox);
        alert("✅ Signature copied! The image is now embedded and should appear in Gmail.");
    }
</script>
