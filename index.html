<script>
    let hostedImageUrl = "https://iili.io/2yOuSp4.png"; // Default placeholder
    const freeImageApiKey = "6d207e02198a847aa98d0a2a901485a5"; // FreeImage.host API Key

    document.getElementById("imageUpload").addEventListener("change", async function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = async function(e) {
                let base64Image = e.target.result.split(",")[1]; // Extract Base64 content
                
                // Upload image to FreeImage.host
                let formData = new FormData();
                formData.append("key", freeImageApiKey);
                formData.append("source", file);
                formData.append("format", "json");

                try {
                    let response = await fetch("https://freeimage.host/api/1/upload", {
                        method: "POST",
                        body: formData
                    });
                    let result = await response.json();
                    if (result.status_code === 200) {
                        hostedImageUrl = result.image.url;
                        document.getElementById("imagePreview").src = hostedImageUrl;
                        updatePreview();
                    } else {
                        alert("Image upload failed. Please try again.");
                    }
                } catch (error) {
                    console.error("Image upload error:", error);
                    alert("Failed to upload image.");
                }
            };
            reader.readAsDataURL(file);
        }
    });

    function updatePreview() {
        document.getElementById("previewName").textContent = document.getElementById("name").value;
        document.getElementById("previewTitle").textContent = document.getElementById("title").value;

        let imgElement = document.getElementById("imagePreview");
        imgElement.src = hostedImageUrl;
        imgElement.style.width = document.getElementById("imageSize").value + "px";
        imgElement.style.height = document.getElementById("imageSize").value + "px";
        document.getElementById("imageSizeValue").textContent = document.getElementById("imageSize").value + "px";
    }

    function copySignature() {
        let previewBox = document.getElementById("preview-box").cloneNode(true);
        document.body.appendChild(previewBox);

        let range = document.createRange();
        range.selectNodeContents(previewBox);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand("copy");

        document.body.removeChild(previewBox);
        alert("✅ Signature copied! If your image doesn’t show up, manually upload it in Gmail.");
    }
</script>
