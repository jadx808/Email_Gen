<script>
    let hostedImageUrl = "https://iili.io/2yOuSp4.png"; // Default placeholder

    document.getElementById("imageUpload").addEventListener("change", async function(event) {
        const file = event.target.files[0];
        if (!file) {
            alert("No file selected.");
            return;
        }

        const reader = new FileReader();
        reader.onload = async function(e) {
            let base64Image = e.target.result.split(",")[1]; // Extract Base64 content
            
            // Upload image to PostImages
            let formData = new FormData();
            formData.append("upload_session", "1"); // Required by PostImages
            formData.append("file", file);

            try {
                let response = await fetch("https://api.postimages.org/json/upload", {
                    method: "POST",
                    body: formData
                });

                let result = await response.json();
                console.log("PostImages Response:", result); // Debugging

                if (result.status === "OK") {
                    hostedImageUrl = result.url; // Get the direct URL
                    document.getElementById("imagePreview").src = hostedImageUrl;
                    document.getElementById("image").value = hostedImageUrl;
                    updatePreview();
                } else {
                    alert("Image upload failed. Try again.");
                }
            } catch (error) {
                console.error("Image upload error:", error);
                alert("Failed to upload image. Check your internet connection.");
            }
        };
        reader.readAsDataURL(file);
    });

    function updatePreview() {
        document.getElementById("previewName").textContent = document.getElementById("name").value;
        document.getElementById("previewTitle").textContent = document.getElementById("title").value;

        let imgElement = document.getElementById("imagePreview");
        imgElement.src = hostedImageUrl;
        imgElement.style.width = document.getElementById("imageSize").value + "px";
        imgElement.style.height = document.getElementById("imageSize").value + "px";
        document.getElementById("imageSizeValue").textContent = document.getElementById("imageSize").value + "px";
    }

    function copySignature() {
        let previewBox = document.getElementById("preview-box").cloneNode(true);
        document.body.appendChild(previewBox);

        let range = document.createRange();
        range.selectNodeContents(previewBox);
        window.getSelection().removeAllRanges();
        window.getSelection().addRange(range);
        document.execCommand("copy");

        document.body.removeChild(previewBox);
        alert("âœ… Signature copied! The image is now embedded and should appear in Gmail.");
    }
</script>
